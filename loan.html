<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Calculator</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: #f4f4f4;
    }

    .circular-container {
      position: relative;
      width: 300px;
      height: 300px;
    }

    svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .thumb {
      fill: #04AA6D;
      cursor: pointer;
    }

    input[type="range"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .value-display {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      text-align: center;
      line-height: 1.3;
    }

    .result {
      margin-top: 30px;
      font-size: 18px;
      text-align: center;
    }

    .result strong {
      font-size: 24px;
      color: #04AA6D;
    }
  </style>
</head>
<body>

<h2>Loan Calculator</h2>

<div class="circular-container">
  <svg viewBox="0 0 300 300">
    <circle cx="150" cy="150" r="100" stroke="#ddd" stroke-width="15" fill="none" />
    <path id="progress" stroke="#04AA6D" stroke-width="15" fill="none" stroke-linecap="round" />
    <circle id="thumb" r="12" class="thumb" cx="150" cy="50" />
  </svg>
  <input type="range" id="loanInput" min="1000" max="10000" step="100" value="5000">
  <div class="value-display" id="valueDisplay">$5,000</div>
</div>

<div class="result">
  <p>Monthly Payment:</p>
  <strong id="monthlyPayment">$429.02</strong>
</div>

<script>
  const input = document.getElementById('loanInput');
  const progress = document.getElementById('progress');
  const thumb = document.getElementById('thumb');
  const valueDisplay = document.getElementById('valueDisplay');
  const monthlyDisplay = document.getElementById('monthlyPayment');

  const center = { x: 150, y: 150 };
  const radius = 100;
  const interestRate = 0.05; // 5% annual interest
  const months = 12;

  function polarToCartesian(cx, cy, r, angleDeg) {
    const angleRad = (angleDeg - 90) * Math.PI / 180;
    return {
      x: cx + r * Math.cos(angleRad),
      y: cy + r * Math.sin(angleRad)
    };
  }

  function describeArc(cx, cy, r, endAngle) {
    const start = polarToCartesian(cx, cy, r, 0);
    const end = polarToCartesian(cx, cy, r, endAngle);
    const largeArc = endAngle > 180 ? 1 : 0;

    return `M ${start.x} ${start.y}
            A ${r} ${r} 0 ${largeArc} 1 ${end.x} ${end.y}`;
  }

  function formatCurrency(value) {
    return `$${parseFloat(value).toLocaleString(undefined, {minimumFractionDigits: 2})}`;
  }

  function updateLoanResult(principal) {
    const r = interestRate / 12;
    const n = months;
    const monthly = (principal * r) / (1 - Math.pow(1 + r, -n));
    monthlyDisplay.textContent = formatCurrency(monthly);
  }

  function updateVisuals(value) {
    const min = +input.min;
    const max = +input.max;
    const angle = (value - min) / (max - min) * 360;

    const pos = polarToCartesian(center.x, center.y, radius, angle);
    progress.setAttribute('d', describeArc(center.x, center.y, radius, angle));
    thumb.setAttribute('cx', pos.x);
    thumb.setAttribute('cy', pos.y);

    valueDisplay.textContent = formatCurrency(value);
    updateLoanResult(value);
  }

  input.addEventListener('input', () => updateVisuals(input.value));

  // Mouse drag support
  let dragging = false;

  thumb.addEventListener('mousedown', () => dragging = true);
  document.addEventListener('mouseup', () => dragging = false);
  document.addEventListener('mousemove', (e) => {
    if (!dragging) return;

    const rect = input.closest('.circular-container').getBoundingClientRect();
    const x = e.clientX - rect.left - center.x;
    const y = e.clientY - rect.top - center.y;
    let angle = Math.atan2(y, x) * 180 / Math.PI + 90;
    if (angle < 0) angle += 360;

    const min = +input.min;
    const max = +input.max;
    const value = min + (angle / 360) * (max - min);
    const stepped = Math.round(value / input.step) * input.step;

    if (stepped >= min && stepped <= max) {
      input.value = stepped;
      updateVisuals(stepped);
    }
  });

  // Initial load
  updateVisuals(input.value);
</script>

</body>
</html>